# お題詳細ページ改善仕様書

## 📋 概要

お題詳細ページをYouTube動画視聴ページのようなUXに改善し、視聴・コメント・滞在時間を最大化する設計を行う。
「お題 = 動画」「回答 = コメント」「回答者 = チャンネル」という対応関係で、没入感のある体験を提供する。

---

## 🎯 目的

- **視聴促進**: お題内容と上位回答を即座に把握できる
- **コメント（回答）促進**: 固定コメントバーで気軽に回答投稿
- **滞在時間向上**: 関連お題、ランキング、プロフィールリンクで回遊を促す

---

## 🎨 レイアウト構成

```
┌─────────────────────────────────────────────────────────────┐
│ [ナビゲーションヘッダー]                                        │
├─────────────────────────────────────┬───────────────────────┤
│                                     │                       │
│  お題メインエリア                      │   サイドバー            │
│  ┌─────────────────────────────┐   │  ┌─────────────────┐  │
│  │ お題カード（大）               │   │  │ 投稿者プロフィール │  │
│  │ - サムネイル背景              │   │  │ - アイコン        │  │
│  │ - お題番号 #042              │   │  │ - 名前           │  │
│  │ - タイトル                   │   │  │ - 投稿数         │  │
│  │ - 統計情報                   │   │  │ - フォローボタン   │  │
│  └─────────────────────────────┘   │  └─────────────────┘  │
│                                     │                       │
│  ┌─────────────────────────────┐   │  ┌─────────────────┐  │
│  │ タグ一覧                      │   │  │ 回答者ランキング   │  │
│  │ #物理 #AI #科学               │   │  │ TOP 5           │  │
│  └─────────────────────────────┘   │  └─────────────────┘  │
│                                     │                       │
│  ┌─────────────────────────────┐   │  ┌─────────────────┐  │
│  │ ピン留め回答（ベスト回答）      │   │  │ 関連お題         │  │
│  │ 📌 いいね1位                  │   │  │ - 同じタグ       │  │
│  │ 📌 いいね2位                  │   │  │ - 同じ投稿者     │  │
│  │ 📌 いいね3位                  │   │  │ - トレンド       │  │
│  └─────────────────────────────┘   │  └─────────────────┘  │
│                                     │                       │
│  ┌─────────────────────────────┐   │                       │
│  │ 回答一覧ヘッダー               │   │                       │
│  │ [いいねが多い順 ▼] [新着順]   │   │                       │
│  └─────────────────────────────┘   │                       │
│                                     │                       │
│  ┌─────────────────────────────┐   │                       │
│  │ 回答カード1                   │   │                       │
│  │ 回答カード2                   │   │                       │
│  │ 回答カード3                   │   │                       │
│  │ ...                          │   │                       │
│  └─────────────────────────────┘   │                       │
│                                     │                       │
└─────────────────────────────────────┴───────────────────────┘
│ [固定コメント投稿バー]                                          │
│ 💬 回答を投稿する... [投稿]                                     │
└─────────────────────────────────────────────────────────────┘
```

---

## 🏗️ 実装フェーズ

### **Phase 1: お題メインエリア**

#### **1-1. お題カード（大型表示）**

**対象ファイル:** `components/topic-detail-card.tsx`（新規作成）

**表示内容:**
- 大型サムネイル背景（科目に応じたグラデーション）
- お題番号 `#042`（中央大きく）
- お題タイトル（下部に大きく表示）
- 統計情報（閲覧数、回答数、いいね数）
- 投稿日時・ステータス（開催中/終了）
- バッジ表示（トレンド/新着/終了間近）

**実装内容:**
- [ ] `TopicDetailCard` コンポーネント作成
- [ ] レスポンシブ対応（モバイル/デスクトップ）
- [ ] 科目別グラデーション背景
- [ ] アニメーション（フェードイン）

---

#### **1-2. タグ一覧（クリック可能）**

**対象ファイル:** `components/topic-tags.tsx`（新規作成）

**機能:**
- タグをクリックで類似お題検索ページへ遷移
- タグごとの投稿数表示（オプション）
- 横スクロール対応

**実装内容:**
- [ ] `TopicTags` コンポーネント作成
- [ ] Link コンポーネントでタグ検索ページへ遷移
- [ ] ホバーエフェクト
- [ ] モバイル対応（横スクロール）

---

#### **1-3. ピン留め回答（上位3件）**

**対象ファイル:** `components/pinned-answers.tsx`（新規作成）

**表示内容:**
- いいね数上位3件を固定表示
- 📌 アイコン付き
- 回答者アバター、名前、いいね数
- 回答本文（省略表示）
- クリックで該当回答へスクロール

**実装内容:**
- [ ] `PinnedAnswers` コンポーネント作成
- [ ] 上位3件の抽出ロジック
- [ ] スクロール機能（smooth scroll）
- [ ] カード型デザイン

---

### **Phase 2: サイドバー**

#### **2-1. 投稿者プロフィールカード**

**対象ファイル:** `components/author-profile-card.tsx`（新規作成）

**表示内容:**
- 投稿者アバター（大）
- 投稿者名
- 投稿数（お題投稿数）
- フォロワー数
- フォローボタン
- 「過去の投稿を見る」リンク

**実装内容:**
- [ ] `AuthorProfileCard` コンポーネント作成
- [ ] フォローボタンの状態管理
- [ ] 投稿者ページへのリンク
- [ ] デスクトップのみ表示（モバイルは折りたたみ）

---

#### **2-2. 回答者ランキング（TOP 5）**

**対象ファイル:** `components/answer-ranking.tsx`（新規作成）

**表示内容:**
- このお題の回答者上位5名
- 順位、アバター、名前、いいね数
- クリックで回答者プロフィールへ

**実装内容:**
- [ ] `AnswerRanking` コンポーネント作成
- [ ] いいね数順ソート
- [ ] 順位アイコン（🥇🥈🥉）
- [ ] リンク機能

---

#### **2-3. 関連お題（おすすめ）**

**対象ファイル:** `components/related-topics.tsx`（新規作成）

**表示内容:**
- 同じタグのお題（3件）
- 同じ投稿者のお題（2件）
- トレンドお題（2件）
- 小型カード形式

**実装内容:**
- [ ] `RelatedTopics` コンポーネント作成
- [ ] フィルタリングロジック（タグ、投稿者）
- [ ] 小型カードデザイン
- [ ] 縦スクロール対応

---

### **Phase 3: 回答一覧**

#### **3-1. 回答ソート機能**

**対象ファイル:** `components/answer-sort-toggle.tsx`（新規作成）

**機能:**
- いいねが多い順 / 新着順 の切り替え
- トグルボタン形式
- 選択状態の視覚的フィードバック

**実装内容:**
- [ ] `AnswerSortToggle` コンポーネント作成
- [ ] 状態管理（useState）
- [ ] ソート処理
- [ ] アクティブ状態のスタイリング

---

#### **3-2. 回答カードコンポーネント**

**対象ファイル:** `components/answer-card.tsx`（新規作成）

**表示内容:**
- 回答者アバター、名前
- 回答本文
- いいね数、返信数
- 投稿日時
- いいねボタン、返信ボタン
- ベストアンサーバッジ（該当する場合）

**実装内容:**
- [ ] `AnswerCard` コンポーネント作成
- [ ] いいねボタンの状態管理
- [ ] 返信機能（折りたたみ）
- [ ] ホバーエフェクト

---

#### **3-3. 回答一覧の無限スクロール**

**対象ファイル:** `app/topic/[id]/page.tsx`

**機能:**
- スクロールで自動読み込み
- スケルトンローディング表示
- 初期表示件数: 10件

**実装内容:**
- [ ] Intersection Observer実装
- [ ] ページネーション処理
- [ ] スケルトンカード表示

---

### **Phase 4: 固定コメント投稿バー**

#### **4-1. コメント投稿バー**

**対象ファイル:** `components/fixed-comment-bar.tsx`（新規作成）

**機能:**
- 画面下部に固定
- テキストエリア（自動拡張）
- 投稿ボタン
- ログイン状態で表示
- 未ログイン時は「ログインして回答する」ボタン

**実装内容:**
- [ ] `FixedCommentBar` コンポーネント作成
- [ ] 固定配置（bottom-0, sticky）
- [ ] テキストエリアの自動拡張
- [ ] 投稿処理（API連携）
- [ ] ログイン状態の判定

---

#### **4-2. 投稿成功時のフィードバック**

**対象ファイル:** `components/fixed-comment-bar.tsx`

**機能:**
- 投稿成功時にトースト通知
- 回答一覧に即座に反映
- スムーズスクロールで投稿位置へ移動

**実装内容:**
- [ ] トースト通知（shadcn/ui Toast使用）
- [ ] 楽観的UI更新
- [ ] スクロール処理

---

### **Phase 5: インタラクション＆アニメーション**

#### **5-1. スムーズスクロール**

**対象ファイル:** `app/topic/[id]/page.tsx`

**機能:**
- ピン留め回答クリックで該当回答へスクロール
- ページ内アンカーリンク
- スムーズアニメーション

**実装内容:**
- [ ] スクロール関数実装
- [ ] アンカーID設定
- [ ] スクロール位置の調整（ヘッダー分のオフセット）

---

#### **5-2. いいねボタンのアニメーション**

**対象ファイル:** `components/answer-card.tsx`

**機能:**
- クリック時にハートアニメーション
- いいね数のカウントアップ
- 楽観的UI更新

**実装内容:**
- [ ] アニメーションCSS（scale, opacity）
- [ ] 状態管理（isLiked）
- [ ] API連携

---

#### **5-3. ホバーエフェクト強化**

**対象ファイル:** 全体

**強化内容:**
- 関連お題カードのホバーで拡大
- 回答カードのホバーで背景色変化
- タグのホバーで色変化

**実装内容:**
- [ ] transition-all クラス追加
- [ ] hover:scale-105 など
- [ ] shadow-lg on hover

---

## 📂 ファイル構成（完成後）

```
app/
└── topic/
    └── [id]/
        └── page.tsx (お題詳細ページメイン)

components/
├── topic-detail-card.tsx (お題カード大型)
├── topic-tags.tsx (タグ一覧)
├── pinned-answers.tsx (ピン留め回答)
├── author-profile-card.tsx (投稿者プロフィール)
├── answer-ranking.tsx (回答者ランキング)
├── related-topics.tsx (関連お題)
├── answer-sort-toggle.tsx (回答ソート)
├── answer-card.tsx (回答カード)
├── fixed-comment-bar.tsx (固定コメント投稿バー)
└── answer-card-skeleton.tsx (スケルトン)

types/
├── topic.ts (既存)
└── answer.ts (新規: 回答型定義)
```

---

## 🎨 デザインガイドライン

### レイアウト
- **2カラムレイアウト**
  - メインエリア: `w-full lg:w-2/3`
  - サイドバー: `w-full lg:w-1/3`
  - モバイルは1カラム（縦積み）

### カラーパレット
- **メインカラー:** `#F4C300` (黄色)
- **ピン留め:** `#EF4444` (赤)
- **いいね:** `#EF4444` (赤・ハート)
- **新着:** `#3B82F6` (青)

### タイポグラフィ
- **お題タイトル:** `text-3xl font-black`
- **回答本文:** `text-base font-medium`
- **統計情報:** `text-sm font-bold`

### スペーシング
- セクション間: `gap-6`
- カード内: `p-6`
- サイドバー要素間: `gap-4`

---

## 🔄 データ構造

### Answer型（新規作成）

```typescript
export interface Answer {
  id: number
  topicId: number
  content: string
  author: {
    id: number
    name: string
    avatar?: string
  }
  likeCount: number
  replyCount: number
  createdAt: string
  isBestAnswer: boolean
  isLiked?: boolean // ユーザーがいいねしたか
}
```

### Topic型（拡張）

```typescript
export interface Topic {
  // 既存のフィールド...
  description?: string // お題の詳細説明
  answers?: Answer[] // 回答一覧
}
```

---

## 📝 実装手順の指定方法

実装時は以下の形式で番号を指定してください:

```
Phase 1-1 を実装してください
```

```
Phase 2 をすべて実装してください
```

各Phaseは独立して実装可能ですが、以下の依存関係があります:
- Phase 3 は Phase 1 完了後が望ましい
- Phase 4 は独立実装可能
- Phase 5 は全Phase完了後が望ましい

---

## 🎯 成功指標

実装完了後、以下の体験が実現されること:

1. **即座の情報把握**: お題と上位回答を3秒以内に把握できる
2. **スムーズな回答投稿**: 2クリック以内で回答を投稿開始できる
3. **高い回遊性**: 関連お題・ランキングから次のお題へ遷移できる
4. **没入感**: YouTube視聴のような快適な閲覧体験

---

## 🔄 更新履歴

- 2025-10-21: 初版作成
